'use strict';class BunzLoader{loaded=new Set();loading=new Map();modulePaths={'scripts':'/js/core/scripts.js','state':'/js/core/state.js','cache':'/js/core/cache.js','modal':'/js/ui/modal.js','toast':'/js/ui/toast.js','cookies':'/js/ui/cookies.js','a11y':'/js/ui/a11y.js','errors':'/js/utils/errors.js','forms':'/js/utils/forms.js','templates':'/js/modules/templates.js','components':'/js/modules/components.js','i18n':'/js/modules/i18n.js','webrtc':'/js/modules/webrtc.js','map':'/js/modules/map.js','canvas':'/js/modules/canvas.js','realtime':'/js/modules/realtime.js',};async load(moduleName){if(this.loaded.has(moduleName)){return Promise.resolve();}if(this.loading.has(moduleName)){return this.loading.get(moduleName);}const promise=this.loadScript(moduleName);this.loading.set(moduleName,promise);try{await promise;this.loaded.add(moduleName);this.loading.delete(moduleName);console.log(`✅ Lazy-loaded:${moduleName}`);}catch(error){console.error(`❌ Failed to load:${moduleName}`,error);this.loading.delete(moduleName);throw error;}return promise;}loadScript(moduleName){return new Promise((resolve,reject)=>{const script=document.createElement('script');script.src=this.modulePaths[moduleName]||`/js/modules/${moduleName}.js`;script.defer=true;script.onload=resolve;script.onerror=reject;document.head.appendChild(script);});}isLoaded(moduleName){return this.loaded.has(moduleName);}async loadAll(moduleNames){return Promise.all(moduleNames.map(name=>this.load(name)));}}window.bunzLoader=new BunzLoader();console.log('✅ BUNZ Loader initialized(lazy-loading enabled)');document.addEventListener('DOMContentLoaded',()=>{requestIdleCallback(()=>{bunzLoader.load('scripts');if(document.getElementById('bunz-modal')){bunzLoader.load('modal');}bunzLoader.load('toast');if(!localStorage.getItem('cookie-consent')){bunzLoader.load('cookies');}bunzLoader.load('a11y');if(document.querySelector('form')){bunzLoader.load('forms');}},{timeout:1000});});document.addEventListener('bunz:loaded',()=>{const needsTemplates=document.querySelector('.video-container,.room-page-container,.meeting-page');if(needsTemplates&&!window.bunzTemplates){bunzLoader.load('templates');}});