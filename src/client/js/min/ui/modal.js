'use strict';class BunzModal{current=null;shellLoaded=false;constructor(){this.init();}async init(){const modal=document.getElementById('bunz-modal');if(!modal)return;await this.ensureModalShell();modal.addEventListener('click',e=>e.target===modal&&this.close());document.addEventListener('keydown',e=>e.key==='Escape'&&this.current&&this.close());}async ensureModalShell(){if(this.shellLoaded)return;const modal=document.getElementById('bunz-modal');if(!modal)return;if(modal.querySelector('.modal-content')){this.shellLoaded=true;this.setupCloseHandler();return;}try{const response=await fetch('/htx/components/modal.htx');if(response.ok){const html=await response.text();modal.innerHTML=html;this.shellLoaded=true;this.setupCloseHandler();console.log('✅ Modal shell loaded from HTX component');}else{this.createFallbackShell(modal);}}catch(e){console.warn('Failed to load modal component,using fallback:',e);this.createFallbackShell(modal);}}createFallbackShell(modal){modal.innerHTML=`<div class="modal-content"><button class="modal-close" aria-label="Close modal">&times;</button><div class="modal-body" id="bunz-modal-body"></div></div>`;this.shellLoaded=true;this.setupCloseHandler();console.log('⚠️ Using fallback modal shell');}setupCloseHandler(){const modal=document.getElementById('bunz-modal');const closeBtn=modal.querySelector('.modal-close');if(closeBtn){closeBtn.addEventListener('click',()=>this.close());}}async open(path){const modal=document.getElementById('bunz-modal');await this.ensureModalShell();const body=modal.querySelector('.modal-body')||document.getElementById('bunz-modal-body');if(!modal||!body)return console.error('Modal body not found');try{await bunzCore.load(path,body);modal.classList.add('active');document.body.style.overflow='hidden';this.current=path;document.dispatchEvent(new CustomEvent('bunz:modal-opened',{detail:{componentPath:path}}));setTimeout(()=>{document.dispatchEvent(new CustomEvent('bunz:modal-content-loaded',{detail:{componentPath:path,modalBody:body}}));},50);}catch(e){console.error('Modal error:',e);}}close(){const modal=document.getElementById('bunz-modal');if(!modal)return;modal.classList.remove('active');document.body.style.overflow='';const body=modal.querySelector('.modal-body');if(body){setTimeout(()=>body.innerHTML='',300);}document.dispatchEvent(new CustomEvent('bunz:modal-closed',{detail:{componentPath:this.current}}));this.current=null;}}window.bunzModal=new BunzModal();window.openModal=(c,o)=>bunzModal.open(c,o);window.closeModal=()=>bunzModal.close();