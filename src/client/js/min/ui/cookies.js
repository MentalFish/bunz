'use strict';class BunzCookies{consentKey='bunz-cookie-consent';preferencesKey='bunz-cookie-preferences';toastId=null;autoRejectTimeout=null;categories={necessary:{name:'Necessary',description:'Required for basic site functionality',required:true,cookies:['bunz-cookie-consent','bunz-cookie-preferences']},functional:{name:'Functional',description:'Remember your preferences(language,theme)',required:false,cookies:['bunz-lang','session']},analytics:{name:'Analytics',description:'Help us improve the site',required:false,cookies:[]},marketing:{name:'Marketing',description:'Personalized advertising',required:false,cookies:[]}};constructor(){this.checkConsent();}checkConsent(){const consent=localStorage.getItem(this.consentKey);if(!consent){if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>{setTimeout(()=>this.showConsentToast(),1000);});}else{setTimeout(()=>this.showConsentToast(),1000);}}else{this.applyConsent(JSON.parse(consent));}}showConsentToast(){if(!window.bunzToast){console.error('BunzToast not loaded');return;}const message=`<strong>ğŸª Cookie Consent</strong><br>We use cookies to provide basic functionality.
By default,all non-essential cookies are rejected.<a href="#" onclick="bunzCookies.showSettings();return false;" style="color:var(--primary);text-decoration:underline;">Manage preferences</a>`;this.toastId=window.bunzToast.show({message,type:'cookie',duration:0,persistent:true,actions:[{label:'Reject All',primary:false,callback:()=>this.rejectAll()},{label:'Accept Necessary Only',primary:false,callback:()=>this.acceptNecessary()},{label:'Accept All',primary:true,callback:()=>this.acceptAll()}]});this.autoRejectTimeout=setTimeout(()=>{console.log('â±ï¸ Auto-rejecting cookies after 10s timeout');this.rejectAll();},10000);document.dispatchEvent(new CustomEvent('bunz:cookie-consent-shown'));}async showSettings(){if(this.autoRejectTimeout){clearTimeout(this.autoRejectTimeout);this.autoRejectTimeout=null;}if(this.toastId&&window.bunzToast){window.bunzToast.dismiss(this.toastId);}try{const response=await fetch('/htx/components/cookie-settings.htx');const html=await response.text();const temp=document.createElement('div');temp.innerHTML=html;const template=temp.querySelector('.cookie-settings');if(!template){console.error('Cookie settings template not found');return;}const saved=this.getPreferences();const categoriesContainer=template.querySelector('#cookie-categories');if(categoriesContainer){categoriesContainer.innerHTML='';Object.entries(this.categories).forEach(([key,cat])=>{const categoryDiv=document.createElement('div');categoryDiv.className='cookie-category';const headerDiv=document.createElement('div');headerDiv.className='cookie-category-header';const label=document.createElement('label');label.className='cookie-category-label';const checkbox=document.createElement('input');checkbox.type='checkbox';checkbox.id=`cookie-${key}`;if(cat.required){checkbox.checked=true;checkbox.disabled=true;}else if(saved[key]){checkbox.checked=true;}const nameSpan=document.createElement('span');const strong=document.createElement('strong');strong.textContent=cat.name;nameSpan.appendChild(strong);if(cat.required){const badge=document.createElement('span');badge.className='badge';badge.textContent='Required';nameSpan.appendChild(badge);}label.appendChild(checkbox);label.appendChild(nameSpan);headerDiv.appendChild(label);categoryDiv.appendChild(headerDiv);const desc=document.createElement('p');desc.className='cookie-category-desc';desc.textContent=cat.description;categoryDiv.appendChild(desc);if(cat.cookies.length>0){const cookiesList=document.createElement('p');cookiesList.className='text-muted';cookiesList.style.fontSize='0.875rem';cookiesList.textContent=`Cookies:${cat.cookies.join(',')}`;categoryDiv.appendChild(cookiesList);}categoriesContainer.appendChild(categoryDiv);});}const modalBody=document.getElementById('bunz-modal-body');if(modalBody){modalBody.innerHTML='';modalBody.appendChild(template);document.getElementById('bunz-modal').classList.add('active');document.body.style.overflow='hidden';}}catch(error){console.error('Failed to load cookie settings template:',error);}}saveSettings(){const preferences={necessary:true,functional:document.getElementById('cookie-functional')?.checked||false,analytics:document.getElementById('cookie-analytics')?.checked||false,marketing:document.getElementById('cookie-marketing')?.checked||false,timestamp:new Date().toISOString()};this.applyConsent(preferences);if(window.closeModal){window.closeModal();}if(window.bunzToast){window.bunzToast.success('Cookie preferences saved!',3000);}}rejectAll(){const preferences={necessary:true,functional:false,analytics:false,marketing:false,timestamp:new Date().toISOString()};this.applyConsent(preferences);if(window.bunzToast){window.bunzToast.info('All non-essential cookies rejected',3000);}}acceptNecessary(){const preferences={necessary:true,functional:false,analytics:false,marketing:false,timestamp:new Date().toISOString()};this.applyConsent(preferences);if(window.bunzToast){window.bunzToast.success('Only necessary cookies accepted',3000);}}acceptAll(){const preferences={necessary:true,functional:true,analytics:true,marketing:true,timestamp:new Date().toISOString()};this.applyConsent(preferences);if(window.bunzToast){window.bunzToast.success('All cookies accepted',3000);}}applyConsent(preferences){if(this.autoRejectTimeout){clearTimeout(this.autoRejectTimeout);this.autoRejectTimeout=null;}localStorage.setItem(this.consentKey,JSON.stringify(preferences));localStorage.setItem(this.preferencesKey,JSON.stringify(preferences));if(!preferences.functional){const necessary=this.categories.necessary.cookies;Object.keys(localStorage).forEach(key=>{if(!necessary.includes(key)&&key!==this.consentKey&&key!==this.preferencesKey){if(!preferences.functional&&(key==='bunz-lang'||key==='session')){}}});}if(this.toastId&&window.bunzToast){window.bunzToast.dismiss(this.toastId);this.toastId=null;}document.dispatchEvent(new CustomEvent('bunz:cookie-consent-changed',{detail:{preferences}}));console.log('âœ… Cookie consent applied:',preferences);}getPreferences(){const saved=localStorage.getItem(this.preferencesKey);return saved ? JSON.parse(saved):{necessary:true,functional:false,analytics:false,marketing:false};}isAllowed(category){const prefs=this.getPreferences();return prefs[category]===true;}resetConsent(){localStorage.removeItem(this.consentKey);localStorage.removeItem(this.preferencesKey);if(window.bunzToast){window.bunzToast.info('Cookie preferences reset',2000);}setTimeout(()=>this.showConsentToast(),500);}}window.bunzCookies=new BunzCookies();console.log('âœ… BUNZ Cookies(GDPR)initialized');